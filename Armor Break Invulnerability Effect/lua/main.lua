local function Armor_Break_Invulnerability_Effect_update(t, dt)
	if not Armor_Break_Invulnerability_Effect:IsEnabled() then
		return
	end
	local hud = managers.hud:script( PlayerBase.PLAYER_INFO_HUD_FULLSCREEN_PD2)
	local Armor_Break_Invulnerability_Effect_hud_panel = hud.panel:child("Armor_Break_Invulnerability_Effect_hud_panel")
	if not Armor_Break_Invulnerability_Effect_hud_panel then
		return
	end
	if Armor_Break_Invulnerability_Effect.effect_timer > 0 then
		Armor_Break_Invulnerability_Effect.effect_timer = Armor_Break_Invulnerability_Effect.effect_timer - TimerManager:main():delta_time()
		Armor_Break_Invulnerability_Effect_hud_panel:set_visible(true)
		local hudinfo = managers.hud:script(PlayerBase.PLAYER_INFO_HUD_PD2)
		Armor_Break_Invulnerability_Effect_hud_panel:animate(hudinfo.flash_icon, 4000000000)
	elseif Armor_Break_Invulnerability_Effect.effect_timer <= 0 then
		Armor_Break_Invulnerability_Effect_hud_panel:stop()
		Armor_Break_Invulnerability_Effect_hud_panel:set_visible(false)
	end
end
if string.lower(RequiredScript) == "lib/managers/hudmanager" then
	Hooks:PostHook(HUDManager, "update", "Armor_Break_Invulnerability_Effect_HUDManager_update", function(self, t, dt)
		Armor_Break_Invulnerability_Effect_update(t, dt)
	end)
end

Hooks:PreHook(PlayerManager, "activate_temporary_upgrade", "Armor_Break_Invulnerability_Effect_PlayerManager_activate_temporary_upgrade", function (self, category, upgrade)
	if not upgrade == "armor_break_invulnerable" then
		return
	end
	local upgrade_value = self:upgrade_value(category, upgrade)
	if not upgrade_value then
		return
	end
	if type(upgrade_value) == "table" then
		if upgrade_value[1] == 2 and upgrade_value[2] == 15 then
			Armor_Break_Invulnerability_Effect.effect_timer = upgrade_value[1]
		end
	end
	local hud = managers.hud:script( PlayerBase.PLAYER_INFO_HUD_FULLSCREEN_PD2)
	if not hud.panel:child("Armor_Break_Invulnerability_Effect_hud_panel") then
		local Armor_Break_Invulnerability_Effect_hud_panel = hud.panel:bitmap({
			name = "Armor_Break_Invulnerability_Effect_hud_panel",
			visible = false,
			texture = "assets/guis/textures/armor_break_invulnerability_effect",
			layer = 0,
			color = Color(Armor_Break_Invulnerability_Effect.settings.color),
			blend_mode = "add",
			w = hud.panel:w(),
			h = hud.panel:h(),
			x = 0,
			y = 0 
		})
	end
end)